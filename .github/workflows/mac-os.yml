# This workflow verifies libtock-rs is usable on Mac OS.

name: ci-mac-os

# We run this workflow during pull request review, but not for Bors merges. We
# can change this if the workflow is reasonably quick and reliable.
on: pull_request

jobs:
  ci-mac-os:
    runs-on: macos-10.15

    steps:
      # Clones a single commit from the libtock-rs repository. The commit cloned
      # is a merge commit between the PR's target branch and the PR's source.
      - name: Clone repository
        uses: actions/checkout@v2

      # The brew commands are spread out over multiple steps so we can see the
      # timings for each step in GitHub Actions' dashboard.
      - name: Brew tap ARMmbed
        run: brew tap ARMmbed/homebrew-formulae

      - name: Brew update
        run: brew update

      - name: Brew install
        run: brew install arm-none-eabi-gcc

      - name: Build and Test
        run: |
          cd "${GITHUB_WORKSPACE}"
          LIBTOCK_PLATFORM=nrf52 cargo build -p libtock_runtime \
            --target=thumbv7em-none-eabi
